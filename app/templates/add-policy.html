<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/fileinput.min.css') }}">
  <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/fileinput.min.js') }}"></script>
  <link rel="icon" href="{{ url_for('static', filename='images/istic.png') }}" type="image/gif"/>
  <title>科技政策数据库展示系统</title>
</head>
<body>
<!-- 顶部导航栏 -->
<header>
  {% import "_macros.html" as macros with context %}
  {{ macros.header("collect.html") }}
</header>
<!-- 页面主体部分 -->
<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12">
      <div class="row">
        <!-- 左侧目录 -->
        <div class="col-xs-12 col-sm-2 col-md-2 col-lg-2">
          <ul class="nav nav-pills nav-stack">
            <li>
              <a href="./collect.html">数据采集</a>
            </li>
            <li>
              <a href="./users.html">用户管理</a>
            </li>
            <li class="active">
              <a href="./add-policy.html">导入数据</a>
            </li>
          </ul>
        </div>
        <!-- 右侧内容 -->
        <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9 tab-content">
          <!-- 导入数据 -->
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4>导入数据</h4>
              <button class="btn btn-primary" data-toggle="modal" data-target="#uploadPackage">批量上传</button>
              <div class="modal" id="uploadPackage" role="dialog" aria-labelledby="uploadPackageLabel">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title" id="uploadPackageLabel">批量上传</h4>
                    </div>
                    <form class="form-horizontal" action="add_batch_policy" method="post" enctype="multipart/form-data" id="packageForm">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="excel_file" class="col-sm-3 control-label">选择Excel文件</label>
                          <div class="col-sm-5">
                            <input type="file" class="form-control" id="excel_file" name="excel_file">
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="zip_file" class="col-sm-3 control-label">选择压缩文件</label>
                          <div class="col-sm-5">
                            <input type="file" class="form-control" id="zip_file" name="zip_file">
                          </div>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button class="btn btn-primary" type="submit" name="submit">确认提交</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel-body">
              <form class="form-horizontal" style="padding-right: 45px;" action="add_one_policy" method="post" enctype="multipart/form-data" id="singleForm">
                <div class="form-group">
                  <p style="margin:0 0 0 50px;">注：带 <span style="color:#a94442;">*</span> 的为必填字段</p>
                </div>
                <div class="form-group">
                  <label for="original-title" class="col-sm-2 control-label">原始标题 <span style="color:#a94442;">*</span></label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="original-title" name="original-title">
                    <p class="error-msg">原始标题不能为空</p>
                  </div>
                </div>
                <div class="form-group">
                  <label for="translated-title" class="col-sm-2 control-label">中文标题 <span style="color:#a94442;">*</span></label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="translated-title" name="translated-title">
                    <p class="error-msg">中文标题不能为空</p>
                  </div>
                </div>
                <div class="form-group">
                  <label for="nation" class="col-sm-2 control-label">国家 <span style="color:#a94442;">*</span></label>
                  <div class="col-sm-3">
                    <input type="text" class="form-control" id="nation" name="nation">
                    <p class="error-msg">国家不能为空</p>
                  </div>
                </div>
                <div class="form-group">
                  <label for="lang" class="col-sm-2 control-label">原始语种 <span style="color:#a94442;">*</span></label>
                  <div class="col-sm-3">
                    <input type="text" class="form-control" id="lang" name="lang">
                    <p class="error-msg">语种不能为空</p>
                  </div>
                </div>
                <div class="form-group">
                  <label for="source-url" class="col-sm-2 control-label">来源url</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="source-url" name="source-url">
                  </div>
                </div>
                <div class="form-group">
                  <label for="field" class="col-sm-2 control-label">主题领域</label>
                  <div class="col-sm-3">
                    <select class="form-control" id="field" name="field">
                      {% set fieldlist = ["综合", "人工智能技术","新代信息通信技术","大数据技术",
                      "新材料技术","现代交通技术","空天技术","生物技术","海洋技术","智能制造","基因技术"] %}
                      {% for field in fieldlist %}
                        <option value="{{ field }}">{{ field }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="doc_type" class="col-sm-2 control-label">政策类型</label>
                  <div class="col-sm-3">
                    <select class="form-control" id="doc_type" name="doc_type">
                      {% set typelist = ["未选择","研究报告","战略规划","技术治理","计划项目"] %}
                      {% for type in typelist %}
                        <option value="{{ type }}">{{ type }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="institution" class="col-sm-2 control-label">发布机构</label>
                  <div class="col-sm-8">
                    <input type="text" class="form-control" id="institution" name="institution">
                  </div>
                </div>
                <div class="form-group">
                  <label for="institution" class="col-sm-2 control-label">发布日期</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control" id="date" name="date">
                  </div>
                </div>
                <div class="form-group">
                  <label for="keywords" class="col-sm-2 control-label">关键词</label>
                  <div class="col-sm-10">
                    <textarea class="form-control" rows="3" id="keywords" name="keywords"></textarea>
                  </div>
                </div>
                <div class="form-group">
                  <label for="abstract" class="col-sm-2 control-label">摘要</label>
                  <div class="col-sm-10">
                    <textarea class="form-control" rows="10" id="abstract" name="abstract"></textarea>
                  </div>
                </div>
                <div class="form-group">
                  <label for="file" class="col-sm-2 control-label">文件</label>
                  <div class="col-sm-5" title="请上传pdf或txt格式文件">
                    <input type="file" class="form-control" id="file" name="file">
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-sm-offset-2 col-sm-10">
                    <button class="btn btn-primary" type="submit" name="submit" id="singleSubmit">确认导入数据</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 页脚 -->
{% import "_macros.html" as macros %}
{{ macros.footer() }}
</body>
<script>
    function addOnePolicy() {
        $.ajax({
            url: "/add_one_policy",
            type: "POST",
            processData: false,
            contentType: false,
            data: {
                "original-title": $("#original-title").val(),
                "translated-title": $("#translated-title").val(),
                "nation": $("#nation").val(),
                "lang": $("#lang").val(),
                "source-url": $("#source-url").val(),
                "field": $("#field").val(),
                "doc-type": $("#doc_type").val(),
                "institution": $("#institution").val(),
                "keywords": $("#keywords").val(),
                "abstract": $("#abstract").val(),
                "file": $('#file').prop('files')[0]
            },
            success: function (data) {
                alert("新增成功");
                $(window).attr("location", "/add-policy.html");
            },
            error: function (e) {
                alert("新增失败");
            }
        });
    }
    function addBatchPolicy() {
        console.log($('#excel_file').prop('files')[0])
        $.ajax({
            url: "/add_batch_policy",
            type: "POST",
            processData: false,
            data: {
                "excelFile": $('#excel_file').prop('files')[0],
                'zipFile': $('#zip_file').prop('files')[0]
            },
            success: function (data) {
                alert("新增成功");
                $(window).attr("location", "/add-policy.html");
            },
            error: function (e) {
                alert("新增失败");
            }
        });
    }

    window.onload = function (){
      singleForm_check();
    }

    function singleForm_check(){
      notEmpty($("#original-title"));
      notEmpty($("#translated-title"));
      notEmpty($("#nation"));
      notEmpty($("#lang"));
    }

    function notEmpty(element){
      element.blur(function (){
        if (! element.val()) {
          element.parent().addClass("has-error");
          element.next().css("display", "inline-block");
          $("#singleSubmit").attr("disabled", true);
        } else {
          element.parent().removeClass("has-error");
          element.next().css("display", "none");
          $("#singleSubmit").attr("disabled", false);
        }
      });
    }

</script>
</html>