<!--<%@ page language="java" contentType="text/html; charset=utf-8"
   pageEncoding="utf-8"%>
<%@ taglib prefix="s" uri="/struts-tags"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
"http://www.w3.org/TR/html4/loose.dtd">-->
<html>

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>Homepage of our system</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <!-- style css -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Responsive-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    <!-- favicon -->
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/gif"/>
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.mCustomScrollbar.min.css') }}">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
    <!-- font awesome -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <!-- select -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap-select.min.css') }}">
    <!-- owl stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext"
          rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.min.css') }}">
    <link rel="stylesoeet" href="{{ url_for('static', filename='css/owl.theme.default.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fancybox.min.css') }}" media="screen">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
</head>

<body>
<div class="container">
    <div class="header_section_top">
        <div class="row">
            <div class="col-sm-12">
                <div class="custom_menu">
                    <ul>
                        <li><a href="index.html">首页</a></li>
                        <li><a href="search_result.html">检索</a></li>
                        <li><a href="browse_by_category.html">分类浏览</a></li>
                        <li><a href="parse.html">采集</a></li>
                        <li><a href="statistics_analysis.html">统计分析</a></li>
                        <li><a href="proofreading.html">审校</a></li>
                    </ul>
                    <div class="user">
                        <img src="{{ url_for('static', filename='images/not_login.png') }}" alt="">
                        <div class="user-name"><a href="login.html">未登录</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <div class="col-md-1 column">
        </div>
        <div class="col-md-10 column">
            <br>
            <br>
            <div class="row clearfix">
                <div class="col-md-3 column">
                    <select name="field" class="selectpicker" style="width:120px;">
                        <option value="">标题</option>
                        <option value="">摘要</option>
                        <option value="">关键词</option>
                    </select>
                </div>
                <div class="col-md-9 column">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search in database">
                        <div class="input-group-append">
                            <button class="btn btn-secondary" type="button"
                                    style="background-color: #f26522; border-color:#f26522">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="container">
                <form class="form-inline">
                    <select name="country" class="selectpicker">
                        <option value="">全部国家</option>
                        <option value="">中国</option>
                        <option value="">美国</option>
                        <option value="">英国</option>
                        <option value="">德国</option>
                        <option value="">意大利</option>
                    </select>
                    <select name="country" class="selectpicker">
                        <option value="">全部领域</option>
                        <option value="">工业</option>
                        <option value="">农业</option>
                        <option value="">经济</option>
                        <option value="">健康</option>
                    </select>
                    <select name="country" class="selectpicker">
                        <option value="">全部机构</option>
                        <option value="">XXX</option>
                        <option value="">XX</option>
                    </select>
                    <button type="submit" class="btn btn-primary" style="margin-right: 20px;">筛选</button>
                </form>
            </div>
            <br>
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <table class="pro-table table table-hover" cellpadding="0" cellspacing="0">
                            <thead>
                            <tr>
                                <th width="100">
                                    编号
                                </th>
                                <th width="700">
                                    标题
                                </th>
                                <th width="130">
                                    原文件类型
                                </th>
                                <th width="100">
                                    状态
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for policy_text in policy_text_list %}
                                <tr {% if not policy_text.checked_file %}class="not-proofreaded"{% endif %}>
                                    <td>{{ policy_text.id }}</td>
                                    <td>
                                        <a href="content_page.html?policy_text_id={{ policy_text.id }}">{{ policy_text.original_title }}</a>
                                    </td>
                                    {#<td>{{ policy_text.release_time.strftime("%Y/%m/%d") }}</td>#}
                                    <td>{{ policy_to_origin_file_dict[policy_text.id].extension }}</td>
                                    <td>
{#                                        {% if policy_text.checked_file %}#}
{#                                            已审校#}
{#                                        {% else %}#}
{#                                            <a id="modal-{{ policy_text.id }}"#}
{#                                               href="#modal-container-{{ policy_text.id }}"#}
{#                                               role="button" data-toggle="modal">未审校</a>#}
{#                                        {% endif %}#}
                                        <a id="modal-{{ policy_text.id }}"
                                           href="#modal-container-{{ policy_text.id }}"
                                           role="button" data-toggle="modal">
                                            {% if policy_text.checked_file %}
                                                已审校
                                            {% else %}
                                                未审校
                                            {% endif %}</a>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <ul class="pagination">
                <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">Next</a></li>
            </ul>
        </div>
        <div class="col-md-1 column">
        </div>
    </div>
</div>

{% for policy_text in policy_text_list %}
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="modal fade" id="modal-container-{{ policy_text.id }}" role="dialog"
                     aria-labelledby="myModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog" style="margin-top: 150px;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" id="myModalLabel">
                                    审校
                                </h4>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            </div>
                            <div class="modal-body">
                                <p><a href="download_by_id?type=origin&id={{ policy_text.id }}">下载原版</a></p>
                                <p><a href="download_by_id?type=trans&id={{ policy_text.id }}">下载翻译版</a></p>
                                <form name="demoForm" id="demoForm-{{ policy_text.id }}" method="post"
                                      enctype="multipart/form-data">
                                    <p>
                                        <label for="upload-{{ policy_text.id }}" style="color:#222222;">上传审校版</label>
                                        <input id="upload-{{ policy_text.id }}" type="file" name="checked_file"
                                               style="display:none;"/>
                                        <input type="text" name="id" style="display: none"
                                               value="{{ policy_text.id }}"/>
                                        {#<span id="filename-{{ policy_text.id }}"#}
                                        {#      style="margin-left: 20px;font-size: small;">未选择任何文件</span>#}
                                    </p>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                <input type="submit" value="保存" class="btn btn-primary"
                                       onclick="uploadAndSubmit({{ policy_text.id }})"/>
                            </div>
                        </div>

                    </div>

                </div>

            </div>
        </div>
    </div>
{% endfor %}

<footer class="panel-footer" style="width: 100%; overflow: hidden;">
    <div class="container">
        <div class="row footer-top" style="text-align: center;">
        </div>
        <hr style="border: 1px  solid #000000;">
        <div class="row" style="text-align: center;">
            <div class="col-sm-3 col-md-3 col-lg-3">
                <a href="#" style=" color: gray;">关于我们</a>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
                <a href="#" style=" color: gray;">联系方式</a></li>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
                <a href="#" style=" color: gray;">相关网站</a></li>
            </div>
            <div class="col-sm-3 col-md-3 col-lg-3">
                <a href="#" style=" color: gray;">特别致谢</a></li>
            </div>
        </div>
        <br>
    </div>
</footer>
<!-- Javascript files-->
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-3.0.0.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/plugin.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap-select.min.js') }}"></script>
<!-- sidebar -->
<script src="{{ url_for('static', filename='js/jquery.mCustomScrollbar.concat.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/custom.js') }}"></script>
<script>
    function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }

    function uploadAndSubmit(policy_id) {
        console.log(policy_id)
        {#var filename = document.getElementById("filename-" + policy_id);#}
        {#var fileInput = document.querySelector("#upload-" + policy_id);#}
        let form = document.getElementById("demoForm-" + policy_id)
        let data = new FormData(form);

        console.log(data)

        $.ajax({
            type: 'POST',
            url: "upload_proofreading",
            data: data,
            cache: false,
            processData: false,
            contentType: false,
            dataType: "text",
            success: function (ret) {
                if (ret === "success") {
                    alert("保存成功！");
                    location.reload();
                }
            }
        });


        //  fileInput.addEventListener("change", function () {
        //      // 获取File引用:
        //      var file = fileInput.files[0];
        //      // 获取File信息:
        //      filename.innerHTML = file.name;
        //      // 读取文件:
        //      var reader = new FileReader();
        //      reader.onload = function (e) {
        //          var
        //              data = e.target
        //                  .result;
        //          preview.style.backgroundImage = 'url(' + data + ')';
        //      };
        //      // 以DataURL的形式读取文件:
        //      reader.readAsDataURL(file);
        //  })
    }
</script>
</body>

</html>