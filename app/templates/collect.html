<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <link rel="icon" href="{{ url_for('static', filename='images/istic.png') }}" type="image/gif"/>
  <title>科技政策数据库展示系统</title>
</head>
<body>
<!-- 顶部导航栏 -->
<header>
  {% import "_macros.html" as macros with context %}
  {{ macros.header("collect.html") }}
</header>
<!-- 页面主体部分 -->
<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12">
      <div class="row">
        <!-- 左侧目录 -->
        <div class="col-xs-12 col-sm-2 col-md-2 col-lg-2">
          <ul class="nav nav-pills nav-stack">
            <li class="active">
              <a href="./collect.html">数据采集</a>
            </li>
            <li>
              <a href="./users.html">用户管理</a>
            </li>
            <li>
              <a href="./add-policy.html">导入数据</a>
            </li>
          </ul>
        </div>
        <!-- 右侧内容 -->
        <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9 tab-content">
          <!-- 数据采集 -->
          <div class="panel panel-default">
            <div class="panel-heading">

                <ol class="breadcrumb">

                <li><h4>数据采集</h4></li>

                <li class="pull-right">

                  <div class="sort">
                    <form action="" class="form-inline">
                      <div class="form-group pull-right">
                      <label>统一采集时间：</label>
                        <select name="sort" class="time-control">
                          <option value="0" {% if time_select == 0 %}selected="selected"{% endif %}>0:00</option>
                          <option value="1" {% if time_select == 1 %}selected="selected"{% endif %}>1:00</option>
                            <option value="2" {% if time_select == 2 %}selected="selected"{% endif %}>2:00</option>
                          <option value="3" {% if time_select == 3 %}selected="selected"{% endif %}>3:00</option>
                        </select>
                      <label>统一采集周期：</label>
                        <select name="sort" class="day-control">
                          <option value="1" {% if day_select == 1 %}selected="selected"{% endif %}>1天</option>
                          <option value="3" {% if day_select == 3 %}selected="selected"{% endif %}>3天</option>
                        <option value="7" {% if day_select == 7 %}selected="selected"{% endif %}>7天</option>
                        </select>
                      </div>
                    </form>
                  </div>
                </li>
              </ol>
            </div>
            <div class="panel-body">
              <table class="table table-hover">
                <tr>
                  <th width="20">操作</th>
                  <th width="25%">网站名称</th>
                  <th width="20%">域名</th>
                  <th width="18%">上次采集时间</th>
                  <th width="17%">新下载文档</th>
                </tr>
                {% for foo in result %}
                  <tr>
                    <td>
                      <button class="btn btn-primary collect-btn" id="collect-btn-{{ foo[2] }}">采集</button>
                    </td>
                    <td>{{ foo[0] }}</td>
                    <td>{{ foo[1] }}</td>
                    <td>{{ foo[3] }}</td>
                    <td class="text-center">
                      <a class="detail-link" data-toggle="collapse" href="#clp-{{ foo[2] }}">
                        <span class="glyphicon glyphicon-chevron-down"></span>
                      </a>
                    </td>
                  </tr>

                  <tr id="clp-{{ foo[2] }}" class="collapse">
                    <td colspan="10">
                      {{ foo[4] }}
                    </td>
                  </tr>
                {% endfor %}
              </table>
{#                <div class="form-check form-switch">#}
{#              <span style="width:20px"></span><input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" checked>#}
{#              <label class="form-check-label" for="flexSwitchCheckChecked">每日24:00自动采集</label>#}
{#          </div>#}
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 页脚 -->
{% import "_macros.html" as macros %}
{{ macros.footer() }}
</body>

<script>
    $(".collect-btn").click(function () {
        let site_name_re = /collect-btn-(\w+)/
        let site_name_in_id = $(this).attr("id");
        let re_group = site_name_in_id.match(site_name_re)
        let site_name = re_group[1]
        console.log(site_name)
        $.ajax({
            url: "/collect_web",
            type: "POST",
            data: {"site_name": site_name},
            success: function (data) {
                console.log(site_name);
                alert(data);
            },
            error: function (e) {
                alert("error");
            }
        });
    });
    $(".day-control").change(function () {
        var day = $(".day-control option:selected").val();
      $.ajax({
            url: "/select_day",
            type: "POST",
            data: {"day": day},
            success: function (data) {
                console.log(day);
                {#alert(data);#}
            },
            error: function (e) {
                alert("error");
            }
        });
  });
    $(".time-control").change(function () {
        var time = $(".time-control option:selected").val();
      $.ajax({
            url: "/select_time",
            type: "POST",
            data: {"time": time},
            success: function (data) {
                console.log(time);
                {#alert(data);#}
            },
            error: function (e) {
                alert("error");
            }
        });
  });

</script>

</html>